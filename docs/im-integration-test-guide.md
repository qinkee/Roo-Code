# Roo-Code IM集成功能测试指南

## 功能概述

Roo-Code 现已支持与即时通讯（IM）系统的深度集成，通过 `@联系人` 和 `@知识库` 引用，实现智能化的消息发送和知识检索功能。

## 前置条件

1. **确保 im-platform MCP 服务器已启动**
   - 检查 MCP 服务器列表中是否有 `im-platform`
   - 确认服务器状态为"已连接"

2. **验证联系人同步**
   - 在输入框中输入 `@` 应该能看到联系人列表
   - 确认好友和群组都正确显示

## 测试场景

### 1. 基础功能测试

#### 1.1 发送简单消息
```
@联系人:张三 今天的天气真不错
```
**预期结果**：AI 将消息"今天的天气真不错"发送给张三

#### 1.2 查询知识库
```
@知识库:技术小组 Docker容器如何配置端口映射？
```
**预期结果**：AI 查询技术小组的知识库，返回关于Docker端口映射的相关信息

### 2. 智能分析场景

#### 2.1 代码分析与分享
```
@联系人:技术主管 请帮我分析 @/src/main.ts 中的性能问题
```
**预期结果**：
- AI 分析 main.ts 文件
- 找出潜在的性能问题
- 生成详细的分析报告
- 将报告发送给技术主管

#### 2.2 错误诊断与通知
```
@联系人:运维小李 @problems 请查看当前工作区的所有错误并生成修复建议
```
**预期结果**：
- AI 获取工作区的所有诊断信息
- 分析每个错误的原因
- 提供修复建议
- 将完整报告发送给运维小李

### 3. 知识库增强场景

#### 3.1 历史经验查询
```
@知识库:张三 之前是如何解决 Redis 连接超时问题的？
```
**预期结果**：
- AI 搜索张三的知识库
- 找到关于 Redis 连接超时的相关记录
- 总结解决方案

#### 3.2 团队知识共享
```
@知识库:前端组 @联系人:新人小王 React Hooks 的最佳实践有哪些？
```
**预期结果**：
- AI 查询前端组的知识库
- 整理 React Hooks 最佳实践
- 将整理好的内容发送给新人小王

### 4. 复杂协作场景

#### 4.1 代码审查与反馈
```
@/src/api/user.controller.ts @联系人:张三 请review这个控制器的代码，重点关注：
1. 错误处理是否完善
2. 是否有潜在的安全问题
3. 性能优化建议
```
**预期结果**：
- AI 深入分析代码
- 从三个维度生成详细的review报告
- 发送给张三

#### 4.2 多文件分析报告
```
@/src/services/ @联系人:架构师 分析services目录下所有文件的依赖关系，生成架构图
```
**预期结果**：
- AI 分析整个services目录
- 理解各服务之间的依赖关系
- 生成文本格式的架构说明
- 发送给架构师

#### 4.3 终端输出分析
```
@terminal @联系人:DevOps 分析最近的构建日志，找出失败原因
```
**预期结果**：
- AI 获取终端输出
- 分析构建失败的原因
- 提供解决方案
- 发送分析结果

### 5. 批量通知场景

#### 5.1 多人通知
```
@联系人:张三 @联系人:李四 明天上午10点技术评审会议，请准时参加
```
**预期结果**：同时向张三和李四发送会议通知

#### 5.2 团队广播
```
@联系人:前端组 @git-changes 请查看最新的代码变更，特别注意API接口的修改
```
**预期结果**：
- AI 分析当前git工作区的变更
- 重点标注API接口相关的修改
- 将分析结果发送给前端组

### 6. 智能问答场景

#### 6.1 技术咨询
```
@知识库:架构师团队 微服务拆分的原则是什么？我们的项目适合拆分吗？
```
**预期结果**：
- AI 查询架构师团队的知识库
- 结合项目实际情况给出建议

#### 6.2 故障排查
```
@知识库:运维组 @联系人:值班人员 生产环境出现OOM，请提供排查步骤
```
**预期结果**：
- AI 从运维组知识库获取OOM排查经验
- 生成详细的排查步骤
- 立即发送给值班人员

### 7. 文档生成场景

#### 7.1 API文档生成
```
@/src/api/ @联系人:前端组 生成所有API接口的文档，包括请求参数和响应格式
```
**预期结果**：
- AI 分析所有API文件
- 生成完整的接口文档
- 发送给前端组

#### 7.2 部署文档
```
@知识库:DevOps @联系人:新人小张 基于知识库生成项目部署指南
```
**预期结果**：
- AI 从DevOps知识库提取部署相关信息
- 生成适合新人的部署指南
- 发送给小张

### 8. 创新应用场景

#### 8.1 代码优化建议
```
@/src/utils/ @知识库:性能优化小组 @联系人:开发团队 分析工具函数的性能并给出优化建议
```
**预期结果**：
- AI 分析utils目录下的代码
- 结合性能优化小组的经验
- 生成优化建议报告
- 发送给开发团队

#### 8.2 安全审计
```
@/src/ @知识库:安全团队 进行代码安全审计，查找潜在的安全漏洞
```
**预期结果**：
- AI 扫描代码寻找安全问题
- 参考安全团队的知识库
- 生成安全审计报告

#### 8.3 技术债务评估
```
@git-changes @知识库:架构师团队 @联系人:项目经理 评估最近一个月的技术债务情况
```
**预期结果**：
- AI 分析代码变更历史
- 结合架构师团队的评估标准
- 生成技术债务报告
- 发送给项目经理

## 测试要点

### 功能验证
1. **消息发送成功率**：确认消息是否成功发送到指定联系人
2. **知识库查询准确性**：验证查询结果是否相关且有用
3. **内容完整性**：检查生成的报告是否完整、格式是否正确

### 性能测试
1. **响应时间**：测量从发送命令到收到结果的时间
2. **大文件处理**：测试分析大型代码文件或目录的性能
3. **并发处理**：同时发送多个请求，验证系统稳定性

### 边界情况
1. **联系人不存在**：输入不存在的联系人名称
2. **知识库为空**：查询没有内容的知识库
3. **文件不存在**：引用不存在的文件路径
4. **网络异常**：MCP服务器连接中断的情况

## 最佳实践

### 1. 明确的指令
提供清晰、具体的任务描述，让AI能够准确理解需求：
```
❌ @联系人:张三 看看这个文件
✅ @联系人:张三 请审查 @/src/auth.ts 的JWT实现是否安全
```

### 2. 合理利用上下文
组合使用多个@引用，提供更丰富的上下文：
```
@/src/config.ts @problems @知识库:配置管理 优化配置文件结构
```

### 3. 结构化输出
要求AI生成结构化的报告：
```
@联系人:团队 生成本周代码质量报告，包括：
1. 代码覆盖率
2. 复杂度分析
3. 潜在问题列表
4. 改进建议
```

### 4. 知识库优先
优先查询知识库中的经验：
```
@知识库:故障处理 @联系人:值班人员 数据库连接池满了怎么处理？
```

## 故障排查

### 问题1：联系人列表为空
- 检查 console 中是否有相关错误
- 确认 im-platform MCP 服务器是否正常运行
- 尝试重新连接 MCP 服务器

### 问题2：消息发送失败
- 检查联系人名称是否正确
- 确认 MCP 工具调用权限
- 查看错误日志了解具体原因

### 问题3：知识库查询无结果
- 确认知识库名称是否正确
- 检查该联系人/群组是否有知识库
- 尝试使用更通用的搜索关键词

## 反馈与改进

如果在测试过程中遇到问题或有改进建议，请记录：
1. 具体的操作步骤
2. 预期结果vs实际结果
3. 错误信息（如果有）
4. 改进建议

## 总结

IM集成功能将Roo-Code从一个单纯的AI编程助手，升级为团队协作的智能中枢。通过灵活组合各种@引用，可以实现：

- 🚀 **智能化工作流**：自动分析、生成报告、通知相关人员
- 📚 **知识管理**：将团队经验转化为可查询的知识库
- 👥 **高效协作**：打破信息孤岛，实现跨团队知识共享
- 🔧 **自动化运维**：故障诊断、日志分析、自动通知
- 📊 **质量保证**：代码审查、安全审计、性能分析

充分发挥想象力，探索更多可能性！