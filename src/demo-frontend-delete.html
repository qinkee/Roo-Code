<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ä½“åˆ é™¤UIç¤ºä¾‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--vscode-editor-background, #1e1e1e);
            color: var(--vscode-editor-foreground, #d4d4d4);
        }
        .agent-card {
            border: 1px solid var(--vscode-panel-border, #3c3c3c);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            background-color: var(--vscode-editor-background, #252526);
        }
        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .agent-name {
            font-size: 18px;
            font-weight: 600;
        }
        .agent-avatar {
            font-size: 24px;
            margin-right: 12px;
        }
        .agent-description {
            color: var(--vscode-descriptionForeground, #cccccc);
            margin-bottom: 12px;
        }
        .agent-actions {
            display: flex;
            gap: 8px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn-delete {
            background-color: var(--vscode-errorBackground, #f14c4c);
            color: var(--vscode-errorForeground, #ffffff);
        }
        .btn-delete:hover {
            background-color: var(--vscode-errorHover, #d32f2f);
        }
        .btn-edit {
            background-color: var(--vscode-button-background, #0e639c);
            color: var(--vscode-button-foreground, #ffffff);
        }
        .btn-edit:hover {
            background-color: var(--vscode-button-hoverBackground, #1177bb);
        }
        .btn-start {
            background-color: var(--vscode-button-secondaryBackground, #5a5d5e);
            color: var(--vscode-button-secondaryForeground, #ffffff);
        }
        .btn-start:hover {
            background-color: var(--vscode-button-secondaryHoverBackground, #6c7172);
        }
        .status-message {
            padding: 12px;
            border-radius: 4px;
            margin: 16px 0;
        }
        .success {
            background-color: var(--vscode-testing-iconPassed, #73c991);
            color: var(--vscode-editor-background, #1e1e1e);
        }
        .error {
            background-color: var(--vscode-errorBackground, #f14c4c);
            color: var(--vscode-errorForeground, #ffffff);
        }
        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .dialog-content {
            background-color: var(--vscode-editor-background, #1e1e1e);
            border: 1px solid var(--vscode-panel-border, #3c3c3c);
            border-radius: 8px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
        }
        .dialog-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        .dialog-message {
            margin-bottom: 24px;
            line-height: 1.5;
        }
        .dialog-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        .btn-cancel {
            background-color: transparent;
            border: 1px solid var(--vscode-panel-border, #3c3c3c);
            color: var(--vscode-editor-foreground, #d4d4d4);
        }
        .btn-cancel:hover {
            background-color: var(--vscode-list-hoverBackground, #2a2d2e);
        }
    </style>
</head>
<body>
    <h1>ğŸ¤– æ™ºèƒ½ä½“ç®¡ç†</h1>
    
    <div id="status-message" class="status-message" style="display: none;"></div>
    
    <div id="agents-container">
        <!-- æ™ºèƒ½ä½“åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
        <div class="agent-card">
            <div class="agent-header">
                <div style="display: flex; align-items: center;">
                    <span class="agent-avatar">ğŸ¤–</span>
                    <span class="agent-name">ä»£ç åŠ©æ‰‹</span>
                </div>
            </div>
            <div class="agent-description">ä¸“ä¸šçš„ä»£ç åˆ†æå’Œä¼˜åŒ–åŠ©æ‰‹ï¼Œæ“…é•¿å¤šç§ç¼–ç¨‹è¯­è¨€</div>
            <div class="agent-actions">
                <button class="btn btn-start" onclick="startAgent('agent-1', 'ä»£ç åŠ©æ‰‹')">
                    å¯åŠ¨ä»»åŠ¡
                </button>
                <button class="btn btn-edit" onclick="editAgent('agent-1')">
                    ç¼–è¾‘
                </button>
                <button class="btn btn-delete" onclick="showDeleteConfirmation('agent-1', 'ä»£ç åŠ©æ‰‹')">
                    åˆ é™¤
                </button>
            </div>
        </div>

        <div class="agent-card">
            <div class="agent-header">
                <div style="display: flex; align-items: center;">
                    <span class="agent-avatar">ğŸ“</span>
                    <span class="agent-name">æ–‡æ¡£åŠ©æ‰‹</span>
                </div>
            </div>
            <div class="agent-description">å¸®åŠ©ç”Ÿæˆå’Œç»´æŠ¤æŠ€æœ¯æ–‡æ¡£çš„ä¸“ä¸šåŠ©æ‰‹</div>
            <div class="agent-actions">
                <button class="btn btn-start" onclick="startAgent('agent-2', 'æ–‡æ¡£åŠ©æ‰‹')">
                    å¯åŠ¨ä»»åŠ¡
                </button>
                <button class="btn btn-edit" onclick="editAgent('agent-2')">
                    ç¼–è¾‘
                </button>
                <button class="btn btn-delete" onclick="showDeleteConfirmation('agent-2', 'æ–‡æ¡£åŠ©æ‰‹')">
                    åˆ é™¤
                </button>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤å¯¹è¯æ¡† -->
    <div id="delete-confirmation" class="confirmation-dialog" style="display: none;">
        <div class="dialog-content">
            <div class="dialog-title">âš ï¸ ç¡®è®¤åˆ é™¤</div>
            <div class="dialog-message" id="delete-message">
                <!-- åˆ é™¤ç¡®è®¤æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            <div class="dialog-actions">
                <button class="btn btn-cancel" onclick="cancelDelete()">å–æ¶ˆ</button>
                <button class="btn btn-delete" onclick="confirmDelete()">åˆ é™¤</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨è¦åˆ é™¤çš„æ™ºèƒ½ä½“ä¿¡æ¯
        let deleteAgentId = null;
        let deleteAgentName = null;

        /**
         * æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
         */
        function showStatusMessage(message, type = 'success') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }

        /**
         * æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
         */
        function showDeleteConfirmation(agentId, agentName) {
            deleteAgentId = agentId;
            deleteAgentName = agentName;
            
            const messageEl = document.getElementById('delete-message');
            messageEl.textContent = `ç¡®å®šè¦åˆ é™¤æ™ºèƒ½ä½“ "${agentName}" å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼Œæ™ºèƒ½ä½“çš„æ‰€æœ‰é…ç½®å’Œæ•°æ®éƒ½å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚`;
            
            document.getElementById('delete-confirmation').style.display = 'flex';
        }

        /**
         * å–æ¶ˆåˆ é™¤
         */
        function cancelDelete() {
            deleteAgentId = null;
            deleteAgentName = null;
            document.getElementById('delete-confirmation').style.display = 'none';
        }

        /**
         * ç¡®è®¤åˆ é™¤æ™ºèƒ½ä½“
         */
        function confirmDelete() {
            if (!deleteAgentId || !deleteAgentName) {
                showStatusMessage('åˆ é™¤æ“ä½œå¼‚å¸¸ï¼šç¼ºå°‘æ™ºèƒ½ä½“ä¿¡æ¯', 'error');
                return;
            }
            
            // éšè—ç¡®è®¤å¯¹è¯æ¡†
            document.getElementById('delete-confirmation').style.display = 'none';
            
            // å‘é€åˆ é™¤æ¶ˆæ¯åˆ°VSCodeæ‰©å±•
            deleteAgent(deleteAgentId, deleteAgentName);
        }

        /**
         * å‘é€åˆ é™¤æ™ºèƒ½ä½“æ¶ˆæ¯åˆ°VSCode
         */
        function deleteAgent(agentId, agentName) {
            console.log(`ğŸ—‘ï¸ åˆ é™¤æ™ºèƒ½ä½“: ${agentName} (${agentId})`);
            
            // æ˜¾ç¤ºloadingçŠ¶æ€
            showStatusMessage('æ­£åœ¨åˆ é™¤æ™ºèƒ½ä½“...', 'loading');
            
            // æ„å»ºåˆ é™¤æ¶ˆæ¯
            const message = {
                type: "deleteAgent",
                agentId: agentId,
                agentName: agentName
            };
            
            try {
                // å‘é€æ¶ˆæ¯åˆ°VSCodeæ‰©å±•åç«¯
                if (typeof vscode !== 'undefined') {
                    vscode.postMessage(message);
                } else {
                    // å¦‚æœåœ¨éVSCodeç¯å¢ƒä¸­æµ‹è¯•ï¼Œæ¨¡æ‹Ÿå¤„ç†
                    console.log('æ¨¡æ‹Ÿåˆ é™¤æ¶ˆæ¯å‘é€:', message);
                    
                    // æ¨¡æ‹Ÿå»¶è¿Ÿå“åº”
                    setTimeout(() => {
                        handleDeleteAgentResult({ success: true });
                        removeAgentFromUI(agentId);
                    }, 1500);
                }
            } catch (error) {
                console.error('å‘é€åˆ é™¤æ¶ˆæ¯å¤±è´¥:', error);
                showStatusMessage('åˆ é™¤è¯·æ±‚å‘é€å¤±è´¥', 'error');
            }
        }

        /**
         * å¤„ç†åˆ é™¤ç»“æœ
         */
        function handleDeleteAgentResult(result) {
            if (result.success) {
                showStatusMessage(`æ™ºèƒ½ä½“ "${deleteAgentName}" å·²æˆåŠŸåˆ é™¤`, 'success');
            } else {
                const errorMessage = result.error || 'æœªçŸ¥é”™è¯¯';
                showStatusMessage(`åˆ é™¤å¤±è´¥: ${errorMessage}`, 'error');
            }
            
            // æ¸…ç†å…¨å±€å˜é‡
            deleteAgentId = null;
            deleteAgentName = null;
        }

        /**
         * ä»UIä¸­ç§»é™¤æ™ºèƒ½ä½“å¡ç‰‡
         */
        function removeAgentFromUI(agentId) {
            // è¿™é‡Œåº”è¯¥æ ¹æ®å®é™…çš„DOMç»“æ„æ¥ç§»é™¤å¯¹åº”çš„æ™ºèƒ½ä½“å¡ç‰‡
            // ç”±äºè¿™æ˜¯ç¤ºä¾‹ï¼Œæˆ‘ä»¬åªæ˜¯æ·»åŠ ä¸€ä¸ª"å·²åˆ é™¤"æ ‡è®°
            const cards = document.querySelectorAll('.agent-card');
            cards.forEach(card => {
                const deleteBtn = card.querySelector('.btn-delete');
                if (deleteBtn && deleteBtn.onclick.toString().includes(agentId)) {
                    card.style.opacity = '0.5';
                    card.style.pointerEvents = 'none';
                    
                    const nameEl = card.querySelector('.agent-name');
                    if (nameEl) {
                        nameEl.textContent += ' (å·²åˆ é™¤)';
                    }
                }
            });
        }

        /**
         * å¯åŠ¨æ™ºèƒ½ä½“ä»»åŠ¡
         */
        function startAgent(agentId, agentName) {
            console.log(`ğŸš€ å¯åŠ¨æ™ºèƒ½ä½“ä»»åŠ¡: ${agentName}`);
            
            const message = {
                type: "startAgentTask",
                agentId: agentId
            };
            
            if (typeof vscode !== 'undefined') {
                vscode.postMessage(message);
            } else {
                console.log('æ¨¡æ‹Ÿå¯åŠ¨ä»»åŠ¡æ¶ˆæ¯:', message);
                showStatusMessage(`æ­£åœ¨å¯åŠ¨ "${agentName}" çš„ä»»åŠ¡...`, 'success');
            }
        }

        /**
         * ç¼–è¾‘æ™ºèƒ½ä½“
         */
        function editAgent(agentId) {
            console.log(`âœï¸ ç¼–è¾‘æ™ºèƒ½ä½“: ${agentId}`);
            
            const message = {
                type: "getAgent",
                agentId: agentId
            };
            
            if (typeof vscode !== 'undefined') {
                vscode.postMessage(message);
            } else {
                console.log('æ¨¡æ‹Ÿç¼–è¾‘æ¶ˆæ¯:', message);
                showStatusMessage('æ­£åœ¨æ‰“å¼€ç¼–è¾‘ç•Œé¢...', 'success');
            }
        }

        /**
         * ç›‘å¬æ¥è‡ªVSCodeæ‰©å±•çš„æ¶ˆæ¯
         */
        if (typeof window !== 'undefined') {
            window.addEventListener('message', event => {
                const message = event.data;
                
                switch (message.type) {
                    case 'action':
                        if (message.action === 'deleteAgentResult') {
                            handleDeleteAgentResult(message);
                        }
                        break;
                }
            });
        }

        /**
         * é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
         */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¬ æ™ºèƒ½ä½“ç®¡ç†é¡µé¢å·²åŠ è½½');
            
            // å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŠ è½½æ™ºèƒ½ä½“åˆ—è¡¨
            // loadAgentsList();
        });

        /**
         * åŠ è½½æ™ºèƒ½ä½“åˆ—è¡¨ï¼ˆç¤ºä¾‹ï¼‰
         */
        function loadAgentsList() {
            const message = {
                type: "listAgents",
                agentListOptions: {}
            };
            
            if (typeof vscode !== 'undefined') {
                vscode.postMessage(message);
            }
        }
    </script>
</body>
</html>