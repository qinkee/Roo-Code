{"version":3,"sources":["webpack:///./src/utils/A2AClient.js"],"names":["A2AClient","constructor","this","isConnected","currentAgent","messageListeners","statusListeners","serviceEndpoint","agentCard","requestIdCounter","agent","console","log","serviceStatus","isActive","Error","officialClient","agentCardUrl","response","fetch","ok","status","json","error","warn","name","description","roleDescription","endpoints","chat","notifyStatusChange","id","message","onMessage","listener","push","onStatusChange","notifyMessage","forEach","detail","generateMessageId","uuidv4","isAgentConnected","type","useStreaming","placeholderId","sendMessageWithStreaming","request","method","params","endpoint","getServiceEndpoint","headers","body","JSON","stringify","statusText","responseData","content","success","result","agentMessage","timestamp","Date","now","agentId","agentName","originalResponse","friendlyMessage","includes","errorMessage","messageId","streaming","thinkingContent","completionContent","stream","contentType","get","reader","getReader","decoder","TextDecoder","buffer","done","read","value","decode","lines","split","pop","line","startsWith","event","substring","trim","data","parsedData","parse","handleStreamEvent","e","eventData","_notified","initialMessage","code","details","text","newContent","_this$agentCard","finalEndpoint","baseEndpoint","url","endsWith","requestId","statusRequest","jsonrpc","removeListener","filter","l","getCurrentUserId","_window$$store","window","$store","state","userStore","userInfo","getCurrentAgent","testClient","startTime","connect","getStatus","disconnect","latency","globalA2AClient"],"mappings":"mRAOO,MAAMA,EACXC,cACEC,KAAKC,aAAc,EACnBD,KAAKE,aAAe,KACpBF,KAAKG,iBAAmB,GACxBH,KAAKI,gBAAkB,GACvBJ,KAAKK,gBAAkB,KACvBL,KAAKM,UAAY,KACjBN,KAAKO,iBAAmB,EAO1B,cAAcC,GACZ,IAME,GALAC,QAAQC,IAAI,mCAAoCF,GAEhDR,KAAKE,aAAeM,EAGQ,WAAxBA,EAAMG,gBAA+BH,EAAMI,SAC7C,MAAM,IAAIC,MAAM,YAIlB,IAAKL,EAAMH,gBACT,MAAM,IAAIQ,MAAM,cAGlBb,KAAKK,gBAAkBG,EAAMH,gBAG7BL,KAAKc,eAAiB,KAGtB,MAAMC,EAAkBP,EAAMH,gBAAT,+BAErB,IACE,MAAMW,QAAiBC,MAAMF,GAC7B,IAAKC,EAASE,GACZ,MAAM,IAAIL,MAAM,+BAA+BG,EAASG,QAE1DnB,KAAKM,gBAAkBU,EAASI,OAChC,MAAOC,GACPZ,QAAQa,KAAK,gEAAiED,GAE9ErB,KAAKM,UAAY,CACfiB,KAAMf,EAAMe,KACZC,YAAahB,EAAMiB,gBACnBC,UAAW,CACTC,KAASnB,EAAMH,gBAAT,UASZ,OAJAL,KAAKC,aAAc,EACnBD,KAAK4B,mBAAmB,aAExBnB,QAAQC,IAAI,+CAAgDF,EAAMqB,KAC3D,EAEP,MAAOR,GAIP,MAHAZ,QAAQY,MAAM,0CAA2CA,GACzDrB,KAAKC,aAAc,EACnBD,KAAK4B,mBAAmB,QAASP,EAAMS,SACjCT,GAOV,mBACE,IACErB,KAAKC,aAAc,EACnBD,KAAKE,aAAe,KACpBF,KAAKK,gBAAkB,KACvBL,KAAKM,UAAY,KAEjBN,KAAK4B,mBAAmB,gBACxBnB,QAAQC,IAAI,uCAEZ,MAAOW,GACPZ,QAAQY,MAAM,uCAAwCA,IAQ1DU,UAAUC,GACgB,oBAAbA,GACThC,KAAKG,iBAAiB8B,KAAKD,GAQ/BE,eAAeF,GACW,oBAAbA,GACThC,KAAKI,gBAAgB6B,KAAKD,GAQ9BG,cAAcL,GACZ9B,KAAKG,iBAAiBiC,QAAQJ,IAC5B,IACEA,EAASF,GACT,MAAOT,GACPZ,QAAQY,MAAM,yCAA0CA,MAU9DO,mBAAmBT,EAAQkB,EAAS,IAClCrC,KAAKI,gBAAgBgC,QAAQJ,IAC3B,IACEA,EAAS,CAAEb,SAAQkB,WACnB,MAAOhB,GACPZ,QAAQY,MAAM,wCAAyCA,MAQ7DiB,oBACE,OAAOC,iBAMTC,mBACE,OAAOxC,KAAKC,aAAqC,OAAtBD,KAAKE,aASlC,kBAAkB4B,EAASW,EAAO,OAAQC,GAAe,EAAMC,EAAgB,MAC7E,IAAK3C,KAAKC,YACR,MAAM,IAAIY,MAAM,WAIlB,GAAI6B,EACF,OAAO1C,KAAK4C,yBAAyBd,EAASW,EAAME,GAGtD,IACElC,QAAQC,IAAI,+BAAgC,CAAEoB,UAASW,SAGvD,MAAMI,EAAU,CACdC,OAAQ,UACRC,OAAQ,CACNjB,QAASA,IAIPkB,QAAiBhD,KAAKiD,qBAE5BxC,QAAQC,IAAI,kCAAmCsC,EAAUH,GAEzD,MAAM7B,QAAiBC,MAAM+B,EAAU,CACrCF,OAAQ,OACRI,QAAS,CACP,eAAgB,mBAChB,OAAU,oBAEZC,KAAMC,KAAKC,UAAUR,KAGvB,IAAK7B,EAASE,GACZ,MAAM,IAAIL,MAAM,QAAQG,EAASG,WAAWH,EAASsC,cAGvD,MAAMC,QAAqBvC,EAASI,OACpCX,QAAQC,IAAI,iCAAkC6C,GAG9C,IAAIC,EAAU,GAEd,GAAID,EAAaE,SAAWF,EAAaG,OACvCF,EAAUD,EAAaG,WAClB,IAAIH,EAAalC,MACtB,MAAM,IAAIR,MAAM,gBAAgB0C,EAAalC,OAE7CmC,EAAU,aAGZ,MAAMG,EAAe,CACnB9B,GAAI7B,KAAKsC,oBACTkB,QAASA,EACTf,KAAM,QACNmB,UAAWC,KAAKC,MAChBC,QAAS/D,KAAKE,aAAa2B,GAC3BmC,UAAWhE,KAAKE,aAAaqB,KAC7B0C,iBAAkBV,GAIpB,OADAvD,KAAKmC,cAAcwB,GACZA,EAEP,MAAOtC,GACPZ,QAAQY,MAAM,sCAAuCA,GAGrD,IAAI6C,EAAkB,UAGpBA,EADE7C,EAAMS,QAAQqC,SAAS,oBAAsB9C,EAAMS,QAAQqC,SAAS,gBACpD,kCACT9C,EAAMS,QAAQqC,SAAS,WACd,oBACT9C,EAAMS,QAAQqC,SAAS,YACd,4BACT9C,EAAMS,QAAQqC,SAAS,aAAe9C,EAAMS,QAAQqC,SAAS,YACpD,wBACT9C,EAAMS,QAAQqC,SAAS,QACd,gBAAgB9C,EAAMS,kBAEtB,+BAIpB,MAAMsC,EAAe,CACnBvC,GAAI7B,KAAKsC,oBACTkB,QAASU,EACTzB,KAAM,QACNmB,UAAWC,KAAKC,MAChBC,QAAS/D,KAAKE,aAAa2B,GAC3BmC,UAAWhE,KAAKE,aAAaqB,MAI/B,MADAvB,KAAKmC,cAAciC,GACb/C,GASV,+BAA+BS,EAASW,EAAO,OAAQE,EAAgB,MACrE,IAAK3C,KAAKC,YACR,MAAM,IAAIY,MAAM,WAIlB,MAAMwD,EAAYrE,KAAKsC,oBAIvB,IACE7B,QAAQC,IAAI,yCAA0C,CAAEoB,UAASW,OAAME,kBAEvE,MAAMK,QAAiBhD,KAAKiD,qBAGtBU,EAAe,CACnB9B,GAAIwC,EACJb,QAAS,GACTb,cAAeA,EACfF,KAAM,QACNmB,UAAWC,KAAKC,MAChBC,QAAS/D,KAAKE,aAAa2B,GAC3BmC,UAAWhE,KAAKE,aAAaqB,KAC7B+C,WAAW,EACXC,gBAAiB,GACjBC,kBAAmB,IAOfxD,QAAiBC,MAAM+B,EAAU,CACrCF,OAAQ,OACRI,QAAS,CACP,eAAgB,mBAChB,OAAU,qBAEZC,KAAMC,KAAKC,UAAU,CACnBP,OAAQ,UACRC,OAAQ,CACNjB,QAASA,EACT2C,QAAQ,OAKd,IAAKzD,EAASE,GACZ,MAAM,IAAIL,MAAM,QAAQG,EAASG,WAAWH,EAASsC,cAIvD,MAAMoB,EAAc1D,EAASkC,QAAQyB,IAAI,gBACzC,IAAKD,IAAgBA,EAAYP,SAAS,qBAAsB,CAE9D,MAAMZ,QAAqBvC,EAASI,OAIpC,OAHAuC,EAAaH,QAAUD,EAAaG,QAAU,aAC9CC,EAAaW,WAAY,EACzBtE,KAAKmC,cAAcwB,GACZA,EAIT,MAAMiB,EAAS5D,EAASmC,KAAK0B,YACvBC,EAAU,IAAIC,YACpB,IAAIC,EAAS,GAETC,GAAO,EACX,OAAQA,EAAM,CACZ,MAAMvB,QAAekB,EAAOM,OAE5B,GADAD,EAAOvB,EAAOuB,KACVA,EAAM,MACV,MAAME,EAAQzB,EAAOyB,MAErBH,GAAUF,EAAQM,OAAOD,EAAO,CAAEV,QAAQ,IAC1C,MAAMY,EAAQL,EAAOM,MAAM,MAC3BN,EAASK,EAAME,OAAS,GAExB,IAAK,MAAMC,KAAQH,EACjB,GAAIG,EAAKC,WAAW,UAAW,CAC7B,MAAMC,EAAQF,EAAKG,UAAU,GAAGC,OAChCnF,QAAQC,IAAI,yBAA0BgF,QACjC,GAAIF,EAAKC,WAAW,SAAU,CACnC,MAAMI,EAAOL,EAAKG,UAAU,GAAGC,OAC/B,GAAIC,EACF,IACE,MAAMC,EAAa1C,KAAK2C,MAAMF,GAC9B7F,KAAKgG,kBAAkBF,EAAYnC,GACnC,MAAOsC,GAEPjG,KAAKgG,kBAAkB,CAAEvD,KAAM,OAAQe,QAASqC,GAAQlC,KAUlE,OAFAA,EAAaW,WAAY,EACzBtE,KAAKmC,cAAcwB,GACZA,EAEP,MAAOtC,GACPZ,QAAQY,MAAM,gCAAiCA,GAG/C,IAAI6C,EAAkB,UAGpBA,EADE7C,EAAMS,QAAQqC,SAAS,oBAAsB9C,EAAMS,QAAQqC,SAAS,gBACpD,kCACT9C,EAAMS,QAAQqC,SAAS,WACd,oBACT9C,EAAMS,QAAQqC,SAAS,YACd,4BACT9C,EAAMS,QAAQqC,SAAS,aAAe9C,EAAMS,QAAQqC,SAAS,YACpD,wBACT9C,EAAMS,QAAQqC,SAAS,QACd,gBAAgB9C,EAAMS,kBAEtB,+BAIpB,MAAMsC,EAAe,CACnBvC,GAAI7B,KAAKsC,oBACTkB,QAASU,EACTzB,KAAM,QACNmB,UAAWC,KAAKC,MAChBC,QAAS/D,KAAKE,aAAa2B,GAC3BmC,UAAWhE,KAAKE,aAAaqB,MAI/B,MADAvB,KAAKmC,cAAciC,GACb/C,GASV2E,kBAAkBE,EAAWvC,GAI3B,GAHAlD,QAAQC,IAAI,qCAAsCwF,IAG7CvC,EAAawC,UAAW,CAC3BxC,EAAawC,WAAY,EAEzB,MAAMC,EAAiB,IAClBzC,EACHH,QAAS,GACTc,WAAW,GAEbtE,KAAKmC,cAAciE,GAIrB,GAAIF,EAAU7E,OAA4B,kBAAnB6E,EAAUG,MAA+C,UAAnBH,EAAUzD,KAAkB,CAEvFkB,EAAalB,KAAO,QACpBkB,EAAaW,WAAY,EAGzB,IAAIF,EAAe,GAEjBA,EADE8B,EAAU7E,MACG6E,EAAU7E,MAChB6E,EAAUI,SAAWJ,EAAUI,QAAQC,KACjCL,EAAUI,QAAQC,KACxBL,EAAUpE,QACJoE,EAAUpE,QAEV,cAIjB,IAAIoC,EAAkB,GAkBtB,OAhBEA,EADEE,EAAaD,SAAS,yDACN,sHACTC,EAAaD,SAAS,YAAcC,EAAaD,SAAS,MACjD,mBACTC,EAAaD,SAAS,YAAcC,EAAaD,SAAS,SACjD,sBACTC,EAAaD,SAAS,eAAiBC,EAAaD,SAAS,MACpD,mBAEA,aAAaC,2BAGjCT,EAAaH,QAAUU,EACvBP,EAAaxC,OAAS,aAGtBnB,KAAKmC,cAAcwB,GAKrB,OAAQuC,EAAUzD,MAChB,IAAK,YAEHkB,EAAaxC,OAAS,YACtB,MAEF,IAAK,QAEHwC,EAAaxC,OAAS,aACtB,MAEF,IAAK,YAEHwC,EAAaxC,OAAS,iBAEtB,MAEF,IAAK,WAAY,CAEVwC,EAAaY,kBAChBZ,EAAaY,gBAAkB,IAGjC,MAAMiC,EAAaN,EAAU1C,SAAW,GACnCG,EAAaY,gBAAgBJ,SAASqC,KACzC7C,EAAaY,iBAAmBiC,GAGlC7C,EAAaH,QAAU,cAAcG,EAAaY,gBAClD,MAGF,IAAK,aAEEZ,EAAaa,oBAChBb,EAAaa,kBAAoB,IAEnCb,EAAaa,mBAAqB0B,EAAU1C,SAAW,GAEvDG,EAAaH,QAAUG,EAAaa,kBACpC,MAEF,IAAK,OAEHb,EAAaxC,OAAS,OACtBwC,EAAaW,WAAY,EACrB4B,EAAUxC,SACZC,EAAaH,QAAU0C,EAAUxC,QAEnC,MAEF,QAEMwC,EAAU1C,UACZG,EAAaH,SAAW0C,EAAU1C,SAMxCxD,KAAKmC,cAAcwB,GAOrB,2BAA2B,IAAA8C,EACzB,IAaIC,EAbAC,EAAe3G,KAAKK,gBAMxB,IAJKsG,GAA8B,QAAlBF,EAAIzG,KAAKM,iBAAS,IAAAmG,GAAdA,EAAgBG,MACnCD,EAAe3G,KAAKM,UAAUsG,MAG3BD,EACH,MAAM,IAAI9F,MAAM,iCAclB,OAXAJ,QAAQC,IAAI,qCAAsCiG,GAKhDD,EADEC,EAAaE,SAAS,KACRF,EAAe,UAEfA,EAAe,WAGjClG,QAAQC,IAAI,2CAA4CgG,GACjDA,EAMT,kBACE,IAAK1G,KAAKC,YACR,MAAM,IAAIY,MAAM,WAGlB,IAEE,MAAMiG,EAAYjD,KAAKC,MACjBiD,EAAgB,CACpBC,QAAS,MACTnF,GAAIiF,EACJhE,OAAQ,kBACRC,OAAQ,IAGJC,QAAiBhD,KAAKiD,qBACtBjC,QAAiBC,MAAM+B,EAAU,CACrCF,OAAQ,OACRI,QAAS,CACP,eAAgB,mBAChB,OAAU,oBAEZC,KAAMC,KAAKC,UAAU0D,KAGvB,IAAK/F,EAASE,GACZ,MAAM,IAAIL,MAAM,QAAQG,EAASG,WAAWH,EAASsC,cAGvD,MAAMC,QAAqBvC,EAASI,OAEpC,GAAImC,EAAalC,MACf,MAAM,IAAIR,MAAM,aAAa0C,EAAalC,MAAMgF,SAAS9C,EAAalC,MAAMS,WAG9E,OAAOyB,EAAaG,QAAUH,EAE9B,MAAOlC,GAEP,MADAZ,QAAQY,MAAM,oCAAqCA,GAC7CA,GAQV4F,eAAejF,GACbhC,KAAKG,iBAAmBH,KAAKG,iBAAiB+G,OAAOC,GAAKA,IAAMnF,GAChEhC,KAAKI,gBAAkBJ,KAAKI,gBAAgB8G,OAAOC,GAAKA,IAAMnF,GAOhEoF,mBAEE,IAAI,IAAAC,EACF,OAAoB,QAAbA,EAAAC,OAAOC,cAAM,IAAAF,GAAO,QAAPA,EAAbA,EAAeG,aAAK,IAAAH,GAAW,QAAXA,EAApBA,EAAsBI,iBAAS,IAAAJ,GAAU,QAAVA,EAA/BA,EAAiCK,gBAAQ,IAAAL,OAAA,EAAzCA,EAA2CxF,KAAM,UACxD,MAAOR,GACP,MAAO,WAOXsG,kBACE,OAAO3H,KAAKE,aAOd,4BAA4BM,GAC1B,MAAMoH,EAAa,IAAI9H,EACjB+H,EAAYhE,KAAKC,MAEvB,UACQ8D,EAAWE,QAAQtH,GACzB,MAAMW,QAAeyG,EAAWG,YAGhC,aAFMH,EAAWI,aAEV,CACLvE,SAAS,EACTtC,OAAQA,EACR8G,QAASpE,KAAKC,MAAQ+D,GAGxB,MAAOxG,GAGP,aAFMuG,EAAWI,aAEV,CACLvE,SAAS,EACTpC,MAAOA,EAAMS,WAOd,MAAMoG,EAAkB,IAAIpI,EAGpBoI","file":"js/chunk-2d21df69.dc1619bd.js","sourcesContent":["import { v4 as uuidv4 } from \"uuid\";\n\n/**\n * A2Aæ™ºèƒ½ä½“å®¢æˆ·ç«¯\n * åŸºäºå®˜æ–¹ @a2a-js/sdk æ ‡å‡†å®ç°A2Aåè®®é€šä¿¡\n * æ”¯æŒæ ‡å‡†JSON-RPC 2.0å’ŒSSEæµå¼å“åº”\n */\nexport class A2AClient {\n  constructor() {\n    this.isConnected = false;\n    this.currentAgent = null;\n    this.messageListeners = [];\n    this.statusListeners = [];\n    this.serviceEndpoint = null;\n    this.agentCard = null;\n    this.requestIdCounter = 1;\n  }\n\n  /**\n   * è¿æ¥åˆ°æ™ºèƒ½ä½“\n   * @param {Object} agent æ™ºèƒ½ä½“ä¿¡æ¯\n   */\n  async connect(agent) {\n    try {\n      console.log('[A2AClient] Connecting to agent:', agent);\n      \n      this.currentAgent = agent;\n      \n      // æ£€æŸ¥æ™ºèƒ½ä½“æ˜¯å¦åœ¨çº¿\n      if (agent.serviceStatus !== 'online' || !agent.isActive) {\n        throw new Error('æ™ºèƒ½ä½“å½“å‰ä¸åœ¨çº¿');\n      }\n\n      // æ£€æŸ¥æœåŠ¡ç«¯ç‚¹\n      if (!agent.serviceEndpoint) {\n        throw new Error('æ™ºèƒ½ä½“æœåŠ¡ç«¯ç‚¹ä¸å¯ç”¨');\n      }\n\n      this.serviceEndpoint = agent.serviceEndpoint;\n      \n      // ä¸ä½¿ç”¨SDKï¼Œç›´æ¥å®ç°A2Aåè®®\n      this.officialClient = null;\n      \n      // è·å–æ™ºèƒ½ä½“å¡ç‰‡ä¿¡æ¯ï¼ˆA2Aæ ‡å‡†ï¼‰\n      const agentCardUrl = `${agent.serviceEndpoint}/.well-known/agent-card.json`;\n      \n      try {\n        const response = await fetch(agentCardUrl);\n        if (!response.ok) {\n          throw new Error(`Failed to fetch agent card: ${response.status}`);\n        }\n        this.agentCard = await response.json();\n      } catch (error) {\n        console.warn('[A2AClient] Failed to fetch agent card, using default config:', error);\n        // ä½¿ç”¨é»˜è®¤é…ç½®\n        this.agentCard = {\n          name: agent.name,\n          description: agent.roleDescription,\n          endpoints: {\n            chat: `${agent.serviceEndpoint}/chat`\n          }\n        };\n      }\n      \n      this.isConnected = true;\n      this.notifyStatusChange('connected');\n      \n      console.log('[A2AClient] Successfully connected to agent:', agent.id);\n      return true;\n      \n    } catch (error) {\n      console.error('[A2AClient] Failed to connect to agent:', error);\n      this.isConnected = false;\n      this.notifyStatusChange('error', error.message);\n      throw error;\n    }\n  }\n\n  /**\n   * æ–­å¼€è¿æ¥\n   */\n  async disconnect() {\n    try {\n      this.isConnected = false;\n      this.currentAgent = null;\n      this.serviceEndpoint = null;\n      this.agentCard = null;\n      \n      this.notifyStatusChange('disconnected');\n      console.log('[A2AClient] Disconnected from agent');\n      \n    } catch (error) {\n      console.error('[A2AClient] Error during disconnect:', error);\n    }\n  }\n  \n  /**\n   * æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨\n   * @param {Function} listener ç›‘å¬å‡½æ•°\n   */\n  onMessage(listener) {\n    if (typeof listener === 'function') {\n      this.messageListeners.push(listener);\n    }\n  }\n  \n  /**\n   * æ³¨å†ŒçŠ¶æ€ç›‘å¬å™¨\n   * @param {Function} listener ç›‘å¬å‡½æ•°\n   */\n  onStatusChange(listener) {\n    if (typeof listener === 'function') {\n      this.statusListeners.push(listener);\n    }\n  }\n  \n  /**\n   * é€šçŸ¥æ¶ˆæ¯ç›‘å¬å™¨\n   * @param {Object} message æ¶ˆæ¯å¯¹è±¡\n   */\n  notifyMessage(message) {\n    this.messageListeners.forEach(listener => {\n      try {\n        listener(message);\n      } catch (error) {\n        console.error('[A2AClient] Error in message listener:', error);\n      }\n    });\n  }\n  \n  /**\n   * é€šçŸ¥çŠ¶æ€å˜åŒ–\n   * @param {string} status çŠ¶æ€\n   * @param {string} detail è¯¦æƒ…\n   */\n  notifyStatusChange(status, detail = '') {\n    this.statusListeners.forEach(listener => {\n      try {\n        listener({ status, detail });\n      } catch (error) {\n        console.error('[A2AClient] Error in status listener:', error);\n      }\n    });\n  }\n  \n  /**\n   * ç”Ÿæˆæ¶ˆæ¯ID\n   */\n  generateMessageId() {\n    return uuidv4();\n  }\n  \n  /**\n   * æ£€æŸ¥æ™ºèƒ½ä½“æ˜¯å¦å·²è¿æ¥\n   */\n  isAgentConnected() {\n    return this.isConnected && this.currentAgent !== null;\n  }\n\n  /**\n   * å‘é€æ¶ˆæ¯ç»™æ™ºèƒ½ä½“ (ç®€åŒ–åè®®ï¼ŒåŒ¹é…å®é™…æ™ºèƒ½ä½“æ”¯æŒ)\n   * @param {string} message æ¶ˆæ¯å†…å®¹\n   * @param {string} type æ¶ˆæ¯ç±»å‹ (text, json)\n   * @param {boolean} useStreaming æ˜¯å¦ä½¿ç”¨æµå¼å“åº”\n   */\n  async sendMessage(message, type = 'text', useStreaming = true, placeholderId = null) {\n    if (!this.isConnected) {\n      throw new Error('æœªè¿æ¥åˆ°æ™ºèƒ½ä½“');\n    }\n\n    // ä¼˜å…ˆä½¿ç”¨æµå¼å“åº”\n    if (useStreaming) {\n      return this.sendMessageWithStreaming(message, type, placeholderId);\n    }\n\n    try {\n      console.log('[A2AClient] Sending message:', { message, type });\n      \n      // ä½¿ç”¨æ™ºèƒ½ä½“å®é™…æ”¯æŒçš„ç®€å•æ ¼å¼\n      const request = {\n        method: \"execute\",\n        params: {\n          message: message\n        }\n      };\n\n      const endpoint = await this.getServiceEndpoint();\n      \n      console.log('[A2AClient] Sending request to:', endpoint, request);\n      \n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify(request)\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const responseData = await response.json();\n      console.log('[A2AClient] Received response:', responseData);\n      \n      // å¤„ç†å“åº”\n      let content = '';\n      \n      if (responseData.success && responseData.result) {\n        content = responseData.result;\n      } else if (responseData.error) {\n        throw new Error(`Agent Error: ${responseData.error}`);\n      } else {\n        content = 'æ™ºèƒ½ä½“å·²å¤„ç†æ‚¨çš„è¯·æ±‚';\n      }\n      \n      const agentMessage = {\n        id: this.generateMessageId(),\n        content: content,\n        type: 'agent',\n        timestamp: Date.now(),\n        agentId: this.currentAgent.id,\n        agentName: this.currentAgent.name,\n        originalResponse: responseData\n      };\n      \n      this.notifyMessage(agentMessage);\n      return agentMessage;\n      \n    } catch (error) {\n      console.error('[A2AClient] Failed to send message:', error);\n      \n      // æ ¹æ®é”™è¯¯ç±»å‹æä¾›å‹å¥½çš„æç¤º\n      let friendlyMessage = 'æŠ±æ­‰ï¼Œå‡ºé”™äº†ï¼';\n      \n      if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œå‡ºé”™äº†ï¼è¯¥æ™ºèƒ½ä½“æš‚æ—¶æ— æ³•è¿æ¥å’Œè¿è¡Œï¼Œè¯·è”ç³»æ™ºèƒ½ä½“åˆ›ä½œè€…ã€‚';\n      } else if (error.message.includes('timeout')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“å“åº”è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•ã€‚';\n      } else if (error.message.includes('HTTP 404')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æœåŠ¡æœªæ‰¾åˆ°ï¼Œè¯·ç¡®è®¤æ™ºèƒ½ä½“æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚';\n      } else if (error.message.includes('HTTP 500') || error.message.includes('HTTP 502')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æœåŠ¡æš‚æ—¶å‡ºç°é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚';\n      } else if (error.message.includes('HTTP')) {\n        friendlyMessage = `æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æœåŠ¡è¿”å›é”™è¯¯ï¼ˆ${error.message}ï¼‰ï¼Œè¯·ç¨åå†è¯•ã€‚`;\n      } else {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æš‚æ—¶æ— æ³•å“åº”ï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»æ™ºèƒ½ä½“åˆ›ä½œè€…ã€‚';\n      }\n      \n      // åˆ›å»ºé”™è¯¯æ¶ˆæ¯\n      const errorMessage = {\n        id: this.generateMessageId(),\n        content: friendlyMessage,\n        type: 'error',\n        timestamp: Date.now(),\n        agentId: this.currentAgent.id,\n        agentName: this.currentAgent.name\n      };\n      \n      this.notifyMessage(errorMessage);\n      throw error;\n    }\n  }\n\n  /**\n   * å‘é€æ¶ˆæ¯å¹¶ä½¿ç”¨SSEæµå¼å“åº”\n   * @param {string} message æ¶ˆæ¯å†…å®¹\n   * @param {string} type æ¶ˆæ¯ç±»å‹ (text, json)\n   */\n  async sendMessageWithStreaming(message, type = 'text', placeholderId = null) {\n    if (!this.isConnected) {\n      throw new Error('æœªè¿æ¥åˆ°æ™ºèƒ½ä½“');\n    }\n\n    // ç”Ÿæˆæ¶ˆæ¯ID\n    const messageId = this.generateMessageId();\n    let streamContent = '';\n    let isThinking = false;\n    \n    try {\n      console.log('[A2AClient] Sending streaming message:', { message, type, placeholderId });\n      \n      const endpoint = await this.getServiceEndpoint();\n      \n      // åˆ›å»ºåˆå§‹æ¶ˆæ¯å¯¹è±¡ï¼ŒåŒ…å«å ä½ç¬¦ID\n      const agentMessage = {\n        id: messageId,\n        content: '',\n        placeholderId: placeholderId,\n        type: 'agent',\n        timestamp: Date.now(),\n        agentId: this.currentAgent.id,\n        agentName: this.currentAgent.name,\n        streaming: true,\n        thinkingContent: '',\n        completionContent: ''\n      };\n      \n      // ä¸è¦ç«‹å³é€šçŸ¥åˆ›å»ºæ¶ˆæ¯ï¼Œç­‰å¾…ç¬¬ä¸€ä¸ªäº‹ä»¶å†åˆ›å»º\n      // this.notifyMessage(agentMessage);\n      \n      // ä½¿ç”¨ fetch å‘é€è¯·æ±‚å¹¶å¤„ç†SSEæµ\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'text/event-stream'\n        },\n        body: JSON.stringify({\n          method: \"execute\",\n          params: {\n            message: message,\n            stream: true  // è¯·æ±‚æµå¼å“åº”\n          }\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      // æ£€æŸ¥æ˜¯å¦ä¸ºSSEå“åº”\n      const contentType = response.headers.get('Content-Type');\n      if (!contentType || !contentType.includes('text/event-stream')) {\n        // å¦‚æœä¸æ˜¯SSEï¼Œé€€å›åˆ°æ™®é€šå“åº”å¤„ç†\n        const responseData = await response.json();\n        agentMessage.content = responseData.result || 'æ™ºèƒ½ä½“å·²å¤„ç†æ‚¨çš„è¯·æ±‚';\n        agentMessage.streaming = false;\n        this.notifyMessage(agentMessage);\n        return agentMessage;\n      }\n\n      // å¤„ç†SSEæµ\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n\n      let done = false;\n      while (!done) {\n        const result = await reader.read();\n        done = result.done;\n        if (done) break;\n        const value = result.value;\n        \n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n        \n        for (const line of lines) {\n          if (line.startsWith('event:')) {\n            const event = line.substring(6).trim();\n            console.log('[A2AClient] SSE Event:', event);\n          } else if (line.startsWith('data:')) {\n            const data = line.substring(5).trim();\n            if (data) {\n              try {\n                const parsedData = JSON.parse(data);\n                this.handleStreamEvent(parsedData, agentMessage);\n              } catch (e) {\n                // å¯èƒ½æ˜¯çº¯æ–‡æœ¬æ•°æ®\n                this.handleStreamEvent({ type: 'text', content: data }, agentMessage);\n              }\n            }\n          }\n        }\n      }\n      \n      // æ ‡è®°æµå¼ç»“æŸ\n      agentMessage.streaming = false;\n      this.notifyMessage(agentMessage);\n      return agentMessage;\n      \n    } catch (error) {\n      console.error('[A2AClient] Streaming failed:', error);\n      \n      // æ ¹æ®é”™è¯¯ç±»å‹æä¾›å‹å¥½çš„æç¤º\n      let friendlyMessage = 'æŠ±æ­‰ï¼Œå‡ºé”™äº†ï¼';\n      \n      if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œå‡ºé”™äº†ï¼è¯¥æ™ºèƒ½ä½“æš‚æ—¶æ— æ³•è¿æ¥å’Œè¿è¡Œï¼Œè¯·è”ç³»æ™ºèƒ½ä½“åˆ›ä½œè€…ã€‚';\n      } else if (error.message.includes('timeout')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“å“åº”è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•ã€‚';\n      } else if (error.message.includes('HTTP 404')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æœåŠ¡æœªæ‰¾åˆ°ï¼Œè¯·ç¡®è®¤æ™ºèƒ½ä½“æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚';\n      } else if (error.message.includes('HTTP 500') || error.message.includes('HTTP 502')) {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æœåŠ¡æš‚æ—¶å‡ºç°é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚';\n      } else if (error.message.includes('HTTP')) {\n        friendlyMessage = `æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æœåŠ¡è¿”å›é”™è¯¯ï¼ˆ${error.message}ï¼‰ï¼Œè¯·ç¨åå†è¯•ã€‚`;\n      } else {\n        friendlyMessage = 'æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æš‚æ—¶æ— æ³•å“åº”ï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»æ™ºèƒ½ä½“åˆ›ä½œè€…ã€‚';\n      }\n      \n      // åˆ›å»ºé”™è¯¯æ¶ˆæ¯\n      const errorMessage = {\n        id: this.generateMessageId(),\n        content: friendlyMessage,\n        type: 'error',\n        timestamp: Date.now(),\n        agentId: this.currentAgent.id,\n        agentName: this.currentAgent.name\n      };\n      \n      this.notifyMessage(errorMessage);\n      throw error;\n    }\n  }\n\n  /**\n   * å¤„ç†æµå¼äº‹ä»¶\n   * @param {Object} eventData äº‹ä»¶æ•°æ®\n   * @param {Object} agentMessage æ¶ˆæ¯å¯¹è±¡\n   */\n  handleStreamEvent(eventData, agentMessage) {\n    console.log('[A2AClient] Handling stream event:', eventData);\n    \n    // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¤„ç†äº‹ä»¶ï¼Œä¸”agentMessageè¿˜æ²¡æœ‰è¢«å‘é€è¿‡ï¼Œåˆ™å…ˆå‘é€ä¸€æ¬¡\n    if (!agentMessage._notified) {\n      agentMessage._notified = true;\n      // ç¡®ä¿ç¬¬ä¸€æ¬¡é€šçŸ¥æ—¶å†…å®¹ä¸ºç©ºï¼Œæ˜¾ç¤ºloadingçŠ¶æ€\n      const initialMessage = {\n        ...agentMessage,\n        content: '', // å¼ºåˆ¶å†…å®¹ä¸ºç©º\n        streaming: true\n      };\n      this.notifyMessage(initialMessage);\n    }\n    \n    // é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ˜¯é”™è¯¯äº‹ä»¶ï¼ˆå¤šç§æ ¼å¼ï¼‰\n    if (eventData.error || eventData.code === 'MESSAGE_ERROR' || eventData.type === 'error') {\n      // é”™è¯¯å¤„ç†\n      agentMessage.type = 'error';\n      agentMessage.streaming = false;\n      \n      // æå–é”™è¯¯ä¿¡æ¯\n      let errorMessage = '';\n      if (eventData.error) {\n        errorMessage = eventData.error;\n      } else if (eventData.details && eventData.details.text) {\n        errorMessage = eventData.details.text;\n      } else if (eventData.message) {\n        errorMessage = eventData.message;\n      } else {\n        errorMessage = 'æ™ºèƒ½ä½“å¤„ç†å‡ºç°æœªçŸ¥é”™è¯¯';\n      }\n      \n      // æ ¹æ®é”™è¯¯ç±»å‹æä¾›å‹å¥½çš„é”™è¯¯æ¶ˆæ¯\n      let friendlyMessage = '';\n      if (errorMessage.includes('language model did not provide any assistant messages')) {\n        friendlyMessage = 'ğŸ¤– æŠ±æ­‰ï¼Œæ™ºèƒ½ä½“æš‚æ—¶æ— æ³•å¤„ç†æ‚¨çš„è¯·æ±‚ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š\\n\\nâ€¢ æ™ºèƒ½ä½“çš„è¯­è¨€æ¨¡å‹é…ç½®æœ‰é—®é¢˜\\nâ€¢ æ‚¨çš„é—®é¢˜å¯èƒ½è¶…å‡ºäº†æ™ºèƒ½ä½“çš„èƒ½åŠ›èŒƒå›´\\nâ€¢ æ™ºèƒ½ä½“æœåŠ¡æš‚æ—¶ä¸ç¨³å®š\\n\\nğŸ’¡ å»ºè®®ï¼šè¯·å°è¯•æ¢ä¸ªæ–¹å¼æé—®ï¼Œæˆ–è”ç³»æ™ºèƒ½ä½“åˆ›ä½œè€…è¿›è¡Œæ’æŸ¥ã€‚';\n      } else if (errorMessage.includes('timeout') || errorMessage.includes('è¶…æ—¶')) {\n        friendlyMessage = 'â° æ™ºèƒ½ä½“å“åº”è¶…æ—¶ï¼Œè¯·ç¨åå†è¯•ã€‚';\n      } else if (errorMessage.includes('network') || errorMessage.includes('fetch')) {\n        friendlyMessage = 'ğŸŒ ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•ã€‚';\n      } else if (errorMessage.includes('rate limit') || errorMessage.includes('é™åˆ¶')) {\n        friendlyMessage = 'ğŸš¦ è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åå†è¯•ã€‚';\n      } else {\n        friendlyMessage = `âŒ æ™ºèƒ½ä½“å¤„ç†å¤±è´¥ï¼š${errorMessage}\\n\\nå¦‚æœé—®é¢˜æŒç»­å‡ºç°ï¼Œè¯·è”ç³»æ™ºèƒ½ä½“åˆ›ä½œè€…ã€‚`;\n      }\n      \n      agentMessage.content = friendlyMessage;\n      agentMessage.status = 'error';\n      \n      // é€šçŸ¥UIæ›´æ–°\n      this.notifyMessage(agentMessage);\n      return;\n    }\n    \n    // æ­£å¸¸äº‹ä»¶å¤„ç†\n    switch (eventData.type) {\n      case 'connected':\n        // è¿æ¥æˆåŠŸ\n        agentMessage.status = 'connected';\n        break;\n        \n      case 'start':\n        // å¼€å§‹å¤„ç†\n        agentMessage.status = 'processing';\n        break;\n        \n      case 'api_start':\n        // APIå¼€å§‹å¤„ç†\n        agentMessage.status = 'api_processing';\n        // ä¸è¦è®¾ç½®å†…å®¹ï¼Œä¿æŒloadingçŠ¶æ€\n        break;\n        \n      case 'thinking': {\n        // AIæ€è€ƒè¿‡ç¨‹\n        if (!agentMessage.thinkingContent) {\n          agentMessage.thinkingContent = '';\n        }\n        // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„å†…å®¹ç‰‡æ®µï¼ˆé¿å…é‡å¤ï¼‰\n        const newContent = eventData.content || '';\n        if (!agentMessage.thinkingContent.includes(newContent)) {\n          agentMessage.thinkingContent += newContent;\n        }\n        // æ›´æ–°æ˜¾ç¤ºå†…å®¹\n        agentMessage.content = `ğŸ¤” æ€è€ƒä¸­...\\n${agentMessage.thinkingContent}`;\n        break;\n      }\n        \n      case 'completion':\n        // AIå›å¤å†…å®¹\n        if (!agentMessage.completionContent) {\n          agentMessage.completionContent = '';\n        }\n        agentMessage.completionContent += eventData.content || '';\n        // åªæ˜¾ç¤ºå›å¤å†…å®¹ï¼Œéšè—æ€è€ƒè¿‡ç¨‹\n        agentMessage.content = agentMessage.completionContent;\n        break;\n        \n      case 'done':\n        // å¤„ç†å®Œæˆ\n        agentMessage.status = 'done';\n        agentMessage.streaming = false;\n        if (eventData.result) {\n          agentMessage.content = eventData.result;\n        }\n        break;\n        \n      default:\n        // å…¶ä»–äº‹ä»¶\n        if (eventData.content) {\n          agentMessage.content += eventData.content;\n        }\n        // ç§»é™¤eventData.messageçš„å¤„ç†ï¼Œé¿å…ç”¨æˆ·é—®é¢˜è¢«é”™è¯¯æ˜¾ç¤º\n    }\n    \n    // é€šçŸ¥UIæ›´æ–°\n    this.notifyMessage(agentMessage);\n  }\n\n\n  /**\n   * è·å–æœåŠ¡ç«¯ç‚¹\n   */\n  async getServiceEndpoint() {\n    let baseEndpoint = this.serviceEndpoint;\n    \n    if (!baseEndpoint && this.agentCard?.url) {\n      baseEndpoint = this.agentCard.url;\n    }\n    \n    if (!baseEndpoint) {\n      throw new Error('No service endpoint available');\n    }\n    \n    console.log('[A2AClient] Original baseEndpoint:', baseEndpoint);\n    \n    // ç¡®ä¿ä¿æŒåŸå§‹åè®®ï¼ˆä¸è¦è‡ªåŠ¨å‡çº§HTTPåˆ°HTTPSï¼‰\n    let finalEndpoint;\n    if (baseEndpoint.endsWith('/')) {\n      finalEndpoint = baseEndpoint + 'execute';\n    } else {\n      finalEndpoint = baseEndpoint + '/execute';\n    }\n    \n    console.log('[A2AClient] Final endpoint before fetch:', finalEndpoint);\n    return finalEndpoint;\n  }\n\n  /**\n   * æŸ¥è¯¢æ™ºèƒ½ä½“çŠ¶æ€\n   */\n  async getStatus() {\n    if (!this.isConnected) {\n      throw new Error('æœªè¿æ¥åˆ°æ™ºèƒ½ä½“');\n    }\n\n    try {\n      // ä½¿ç”¨A2Aæ ‡å‡†JSON-RPCæ ¼å¼æŸ¥è¯¢çŠ¶æ€\n      const requestId = Date.now();\n      const statusRequest = {\n        jsonrpc: \"2.0\",\n        id: requestId,\n        method: \"agent.getStatus\",\n        params: {}\n      };\n      \n      const endpoint = await this.getServiceEndpoint();\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify(statusRequest)\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const responseData = await response.json();\n      \n      if (responseData.error) {\n        throw new Error(`A2A Error ${responseData.error.code}: ${responseData.error.message}`);\n      }\n      \n      return responseData.result || responseData;\n      \n    } catch (error) {\n      console.error('[A2AClient] Failed to get status:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * ç§»é™¤ç›‘å¬å™¨\n   * @param {Function} listener ç›‘å¬å™¨å‡½æ•°\n   */\n  removeListener(listener) {\n    this.messageListeners = this.messageListeners.filter(l => l !== listener);\n    this.statusListeners = this.statusListeners.filter(l => l !== listener);\n  }\n\n\n  /**\n   * è·å–å½“å‰ç”¨æˆ·ID\n   */\n  getCurrentUserId() {\n    // è¿™é‡Œåº”è¯¥ä»Vuex storeè·å–ç”¨æˆ·ID\n    try {\n      return window.$store?.state?.userStore?.userInfo?.id || 'unknown';\n    } catch (error) {\n      return 'unknown';\n    }\n  }\n\n  /**\n   * è·å–å½“å‰è¿æ¥çš„æ™ºèƒ½ä½“\n   */\n  getCurrentAgent() {\n    return this.currentAgent;\n  }\n\n  /**\n   * æµ‹è¯•æ™ºèƒ½ä½“è¿æ¥\n   * @param {Object} agent æ™ºèƒ½ä½“ä¿¡æ¯\n   */\n  static async testConnection(agent) {\n    const testClient = new A2AClient();\n    const startTime = Date.now();\n    \n    try {\n      await testClient.connect(agent);\n      const status = await testClient.getStatus();\n      await testClient.disconnect();\n      \n      return {\n        success: true,\n        status: status,\n        latency: Date.now() - startTime\n      };\n      \n    } catch (error) {\n      await testClient.disconnect();\n      \n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n}\n\n// åˆ›å»ºå…¨å±€å®ä¾‹\nexport const globalA2AClient = new A2AClient();\n\n// å¯¼å‡ºé»˜è®¤å®ä¾‹\nexport default globalA2AClient;"],"sourceRoot":""}